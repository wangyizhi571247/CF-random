<!-- by @wangyizhi571247 -->
<!-- version 0.1 -->

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CF-random</title>
</head>
<body>
    <script>
        function randint(l,r) // [l,r]
        {
            return Math.floor(Math.random()*(r-l+1))+l;
        }
        var fetched=0;
        var problemset;
        function fetchProblems(callback)
        {
            if(fetched==1)
            {
                callback(problemset);
                return;
            }
            fetch('https://codeforces.com/api/problemset.problems')
                .then(response=>{
                    return response.json();
                })
                .then(data=>{
                    return data.result.problems;
                })
                .then(problems=>{
                    // console.log(problems);
                    problemset=problems;
                    fetched=1;
                    callback();
                });
        }
        /*
            contestId: int
            index: string
            name: string
            rating: int
            tags: array(string)
            type: string
        */
        function newProblemLinker(problem)
        {
            const element=document.createElement("a");
            element.text=problem.contestId+problem.index+" "+problem.name+"("+problem.rating+")";
            element.href="https://codeforces.com/problemset/problem/"+problem.contestId+"/"+problem.index;
            element.target="_blank";
            element.rel="noopener noreferrer";
            console.log(element.href);
            return element;
        }
        function newBrElement()
        {
            const element=document.createElement("br");
            return element;
        }
        function main()
        {
            console.log("random");
            mindifficulty=Number(document.getElementById("min-difficulty").value);
            maxdifficulty=Number(document.getElementById("max-difficulty").value);
            if(isNaN(mindifficulty)||mindifficulty==0) mindifficulty=800;
            if(isNaN(maxdifficulty)||maxdifficulty==0) maxdifficulty=3500;
            console.log(mindifficulty+'~'+maxdifficulty);
            fetchProblems(function()
            {
                var problemfilter=new Array();
                for(const problem of problemset)
                {
                    if(problem.rating<=maxdifficulty&&problem.rating>=mindifficulty)
                    {
                        problemfilter.push(problem);
                    }
                }
                // console.log(problems);
                const length=problemfilter.length;
                console.log(length);
                if(length==0)
                {
                    console.log("error: filter size = 0");
                    return;
                }
                const randpos=randint(0,length);
                console.log(randpos);
                const problem=problemfilter[randpos];
                console.log(problem);
                const Element=document.querySelector("div.randomlist");
                console.log(Element);
                Element.insertBefore(newProblemLinker(problem),Element.lastChild.nextSibling);
                Element.insertBefore(newBrElement(),Element.lastChild.nextSibling);
            });
        }
    </script>
    <div class="filterlist" style="margin-left:50px;height:200px;width:600px;float:left;">
        <p><b>Filter</b></p>
        <input type="text" id="min-difficulty" placeholder="min-difficulty" style="margin-left:75px;">
        <a> ~ </a>
        <input type="text" id="max-difficulty" placeholder="max-difficulty">
        <br><br>
        <button onclick="main()" style="margin-left:200px;">
            <b>random!</b>
        </button>
    </div>
    <div class="randomlist" style="margin-left:50px;height:1000px;width:600px;float:left;">
        <p><b>Problems</b></p>
    </div>
</body>

</html>
