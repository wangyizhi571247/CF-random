<!-- by @wangyizhi571247 -->
<!-- version 1.1 -->

<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>CF-random</title>
</head>
<!-- csss -->
<style>
/* div */
div.divList
{
    margin-left: 20px;
    height: 350px;
    width: 600px;
    float: left;
}
div.divArea
{
    margin-left: 20px;
}
div.divProblem
{
    font-size: 12px;
}
/* a */
a.aText
{
    font-size: 12px;
}
a.aFootLink
{
    font-size: 10px;
    text-decoration: none;
    /* (52,152,219) */
    color: #172ada;
    font-weight: bold;
}
a.aProblemLink /* without underline */
{
    font-size: 15px;
    text-decoration: none;
    /* (52,152,219) */
    color: #42a0c3;
    font-weight: bold;
}
/* p */
p.pText
{
    font-size: 12px;
}
/* select */
select.selectBox100
{
    width: 100px;
}
/* input */
input.inputBox150
{
    width: 150px;
    height: 15px;
    font-size: 12px;
}
/* button */
button.buttonRandom /* unique */
{
    margin-left: 200px; /* i don't know whyyyyyyyy */
}
button.buttonNoBorder /* button without border */
{
    font-size: 12px;
    border: none;
    background-color: #ffc8c8;
    color: #ef5151;
}
</style>
<body>
	<!-- jss -->
	<script>
/*
	structure of a problem:
	contestId: int
	index: string
	name: string
	rating: int
	tags: array(string)
	type: string
*/

		// get a random interger in [l,r]
		function randint(l,r)
		{
			return Math.floor(Math.random()*(r-l+1))+l;
		}
		// unique the array
		function unique(arr)
		{
			return Array.from(new Set(arr));
		}



	//--------------------------
	// important variables

		var fetched=0; // to check whether the problemset is fetched
		var problemset; // whole problemset
		var randomlist=new Array(); // problems which are chosen

	// ---------------------------
	// functions

		// set local storage of randomlist
		function setRandomlistStorage()
		{
			localStorage.setItem("randomlist",JSON.stringify(randomlist));
			console.log(localStorage);
		}
		// get local storage of randomlist
		function getRandomlistStorage()
		{
			randomlist=JSON.parse(localStorage.getItem("randomlist"));
			if(randomlist==null) randomlist=new Array();
			console.log(randomlist);

			// add problems!!!!
			for(const problem of randomlist)
			{
				addProblem(problem);
			}
		}

		// set local storage of randomlist
		function setTagStorage()
		{
			const includedTags=document.getElementById("included-tags").value;
			const excludedTags=document.getElementById("excluded-tags").value;
			localStorage.setItem("includedTags",includedTags);
			localStorage.setItem("excludedTags",excludedTags);
			console.log(localStorage);
		}
		// get local storage of randomlist
		function getTagStorage()
		{
			var includedTags=localStorage.getItem("includedTags");
			var excludedTags=localStorage.getItem("excludedTags");

			if(includedTags==null) includedTags="";
			if(excludedTags==null) excludedTags="";

			console.log(includedTags);
			console.log(excludedTags);

			inputIncludedTag(includedTags);
			inputExcludedTag(excludedTags);
		}

		// set local storage of randomlist
		function setDifficultyStorage()
		{
			const minDifficulty=document.getElementById("min-difficulty").value;
			const maxDifficulty=document.getElementById("max-difficulty").value;
			localStorage.setItem("minDifficulty",minDifficulty);
			localStorage.setItem("maxDifficulty",maxDifficulty);
			console.log(localStorage);
		}
		// get local storage of randomlist
		function getDifficultyStorage()
		{
			var minDifficulty=localStorage.getItem("minDifficulty");
			var maxDifficulty=localStorage.getItem("maxDifficulty");

			if(minDifficulty==null) minDifficulty=800;
			if(maxDifficulty==null) maxDifficulty=3500;

			console.log(minDifficulty);
			console.log(maxDifficulty);

			document.getElementById("min-difficulty").value=minDifficulty;
			document.getElementById("max-difficulty").value=maxDifficulty;
		}

		// set local storage of "use-prefix-CF" and "use-luogu-link"
		function setCheckboxStorage()
		{
			const useluogulink=document.getElementById("use-luogu-link").checked;
			const useprefixCF=document.getElementById("use-prefix-CF").checked;
			localStorage.setItem("useLuoguLink",useluogulink);
			localStorage.setItem("usePrefixCF",useprefixCF);
			console.log(localStorage);
		}
		// get local storage
		function getCheckboxStorage()
		{
			var useluogulink=localStorage.getItem("useLuoguLink");
			var useprefixCF=localStorage.getItem("usePrefixCF");

			useluogulink=(useluogulink=="true");
			useprefixCF=(useprefixCF=="true");

			// console.log(useluogulink);
			// console.log(useprefixCF);

			document.getElementById("use-luogu-link").checked=useluogulink;
			document.getElementById("use-prefix-CF").checked=useprefixCF;
		}

		function setAllStorage()
		{
			setRandomlistStorage();
			setTagStorage();
			setDifficultyStorage();
			setCheckboxStorage();
		}
		function getAllStorage()
		{
			getRandomlistStorage();
			getTagStorage();
			getDifficultyStorage();
			getCheckboxStorage();
		}

		// process after loading
		document.addEventListener("DOMContentLoaded", function() {
			console.log("DOM Content loaded.");
			getAllStorage();
		});


		// fetch the whole problemset
		function fetchProblems(callback)
		{
			if(fetched==1)
			{
				callback();
				return;
			}
			// document.getElementById("random-main").disabled=true;
			fetch('https://codeforces.com/api/problemset.problems')
				.then(response=>{
					return response.json();
				})
				.then(data=>{
					return data.result.problems;
				})
				.then(problems=>{
					// console.log(problems);
					problemset=problems;
					fetched=1;
					document.getElementById("random-main").disabled=false;
					callback();
				});
		}

		// create a new element of the problem
		// div class: divProblem
		// a (with href) class: aProblemLink (without underline)
		// add problem to div class=randomlistProblems
		function addProblem(problem)
		{
			console.log(`add ${problem}`);

			const text=problem.contestId+problem.index+" "+problem.name+"("+problem.rating+")";

			// if checkbox "use-luogu-link" is checked, use "luogu.com.cn/problem/CF*"
			// otherwise use "codeforces.com/problemset/problem/*"
			const useluogulink=document.getElementById("use-luogu-link").checked;
			if(useluogulink) console.log("use-luogu-link on");
			
			var link;
			if(useluogulink) link="https://www.luogu.com.cn/problem/CF"+problem.contestId+problem.index;
			else link="https://codeforces.com/problemset/problem/"+problem.contestId+"/"+problem.index;
			console.log(link);

			const divElement=document.createElement("div");
			divElement.className="divProblem";

			const aElement=document.createElement("a");
			aElement.className="aProblemLink";
			
			aElement.text=text;
			aElement.href=link;

			const ID=String(randint(0,2147483647));
			divElement.id=ID;

			const buttonElement=document.createElement("button");
			buttonElement.className="buttonNoBorder";
			buttonElement.textContent="delete";
			buttonElement.onclick=function()
			{
				randomlist.splice(randomlist.indexOf(problem),1);

				setAllStorage();
				
				document.getElementById(ID).remove();
			};

			divElement.appendChild(aElement);
			divElement.appendChild(buttonElement);

			const Element=document.getElementById("randomlistProblems");
			
			Element.appendChild(divElement);
		}
		
		// user-main
		// run only when click botton "random-main"
		function main()
		{
			console.log("random");

			// get *-difficulty from inputbox *-difficulty
			mindifficulty=Number(document.getElementById("min-difficulty").value);
			maxdifficulty=Number(document.getElementById("max-difficulty").value);
			if(isNaN(mindifficulty)||mindifficulty==0) mindifficulty=800;
			if(isNaN(maxdifficulty)||maxdifficulty==0) maxdifficulty=3500;
			console.log(mindifficulty+'~'+maxdifficulty);

			// get ??cluded-tags from inputbox ??cluded-tags, separated by ','
			// note: a tag will be included when input is a substring of the tag
			includedtags=document.getElementById("included-tags").value.split(',');
			excludedtags=document.getElementById("excluded-tags").value.split(',');
			includedtags=unique(includedtags);
			excludedtags=unique(excludedtags);
			console.log(includedtags);
			console.log(excludedtags);

			fetchProblems(function()
			{
				var problemfilter=new Array(); // problems satisfied the constraints
				// for each problem in problemset, check if is valid
				for(const problem of problemset)
				{
					var valid=1;
					if(!(problem.rating<=maxdifficulty&&problem.rating>=mindifficulty)) valid=0;

					if(!(includedtags.length==1&&includedtags[0]==""))
						for(const tag of includedtags)
					{
						var flag=0;
						for(const probtag of problem.tags)
							if(probtag.includes(tag))
							{
								flag=1;
								break;
							}
						if(!flag) valid=0;
					}

					if(!(excludedtags.length==1&&excludedtags[0]==""))
						for(const tag of excludedtags)
					{
						for(const probtag of problem.tags)
							if(probtag.includes(tag))
							{
								valid=0;
								break;
							}
					}

					if(valid) problemfilter.push(problem);
				}
				const length=problemfilter.length;
				console.log(length);
				if(length==0)
				{
					console.log("error: filter size = 0");
					return;
				}

				const randpos=randint(0,length-1);
				console.log(randpos);
				const problem=problemfilter[randpos];

				addProblem(problem);
				randomlist.push(problem);

				setAllStorage();
			});
		}

		// clear the randomlist
		function clearRandomlist()
		{
			const check=window.confirm("are you sure?");

			if(!check) return;

			randomlist=new Array();

			// delete all elements of div 
			const Element=document.getElementById("randomlistProblems");
			while(Element.lastChild!=null)
			{
				Element.removeChild(Element.lastChild);
			}

			setAllStorage();
		}
		// copy text to clip
		function copyToClip(text)
		{
			var aux=document.createElement("input");
			aux.setAttribute("value",text);
			document.body.appendChild(aux);
			aux.select();
			document.execCommand("copy");
			document.body.removeChild(aux);
		}
		// export the randomlist (copy to the clipboard)
		function copyRandomlist()
		{
			var prefix="";
			
			const prefixCFElement=document.getElementById("use-prefix-CF");
			if(prefixCFElement.checked) prefix="CF";

			console.log(`prefix: ${prefix}`);

			var str=new String(); // string to output
			// for all problems in random list, add its index
			for(pos=0;pos<randomlist.length;pos++)
			{
				const problem=randomlist[pos];
				if(pos!=0) str+=",";
				str+=prefix+problem.contestId+problem.index;
			}
			console.log(str);
			// copy to the clipboard
			// navigator.clipboard.writeText(str); // only support for Edge
			copyToClip(str);
			console.log("copied");
		}
	</script>
	<!-- for filter -->
	<div id="filterlist" class="divList">
		<p><b>Filter</b></p>
		<!-- difficulty selector -->
		<div id="difficultySelector" class="divArea">
			<a class="aText">difficulty range:</a>
			<!-- min-difficulty selector -->
			<select id="min-difficulty" class="selectBox100" title="min difficulty">
				<option value="800" selected>800</option>
				<option value="900">900</option>
				<option value="1000">1000</option>
				<option value="1100">1100</option>
				<option value="1200">1200</option>
				<option value="1300">1300</option>
				<option value="1400">1400</option>
				<option value="1500">1500</option>
				<option value="1600">1600</option>
				<option value="1700">1700</option>
				<option value="1800">1800</option>
				<option value="1900">1900</option>
				<option value="2000">2000</option>
				<option value="2100">2100</option>
				<option value="2200">2200</option>
				<option value="2300">2300</option>
				<option value="2400">2400</option>
				<option value="2500">2500</option>
				<option value="2600">2600</option>
				<option value="2700">2700</option>
				<option value="2800">2800</option>
				<option value="2900">2900</option>
				<option value="3000">3000</option>
				<option value="3100">3100</option>
				<option value="3200">3200</option>
				<option value="3300">3300</option>
				<option value="3400">3400</option>
				<option value="3500">3500</option>
			</select>
			<a> ~ </a>
			<!-- max-difficulty selector -->
			<select id="max-difficulty" class="selectBox100" title="max difficulty">
				<option value="800">800</option>
				<option value="900">900</option>
				<option value="1000">1000</option>
				<option value="1100">1100</option>
				<option value="1200">1200</option>
				<option value="1300">1300</option>
				<option value="1400">1400</option>
				<option value="1500">1500</option>
				<option value="1600">1600</option>
				<option value="1700">1700</option>
				<option value="1800">1800</option>
				<option value="1900">1900</option>
				<option value="2000">2000</option>
				<option value="2100">2100</option>
				<option value="2200">2200</option>
				<option value="2300">2300</option>
				<option value="2400">2400</option>
				<option value="2500">2500</option>
				<option value="2600">2600</option>
				<option value="2700">2700</option>
				<option value="2800">2800</option>
				<option value="2900">2900</option>
				<option value="3000">3000</option>
				<option value="3100">3100</option>
				<option value="3200">3200</option>
				<option value="3300">3300</option>
				<option value="3400">3400</option>
				<option value="3500" selected>3500</option>
			</select>
		</div>
		<br>
		<!-- include tags selector -->
		<div id="includedtagsSelector" class="divArea">
			<!-- js for selector -->
			<script>
				function inputIncludedTag(newtag)
				{
					console.log(`include ${newtag}`);
					const inputElement=document.getElementById("included-tags");
					if(inputElement.value!="") inputElement.value+=",";
					inputElement.value+=newtag;
				}
				// add the tag selected currently to input box
				function addIncludedTag()
				{
					const selectorElement=document.getElementById("included-tags-selector");
					const newtag=selectorElement.value;
					inputIncludedTag(newtag);
				}
				// clear inputbox
				function clearIncludedTag()
				{
					const selectorElement=document.getElementById("included-tags-selector");
					const newtag=selectorElement.value;
					console.log("clear");
					const inputElement=document.getElementById("included-tags");
					inputElement.value="";
				}
			</script>
			<a class="aText">included tags:</a>
			<input type="text" id="included-tags" class="inputBox150" placeholder="empty">
			<button id="included-tags-clear-button" onclick="clearIncludedTag()" class="aText">clear</button>
			<select id="included-tags-selector" class="selectBox100" title="include tags selector">
				<option value="2-sat">2-sat</option>
				<option value="binary search">binary search</option>
				<option value="bitmasks">bitmasks</option>
				<option value="brute force">brute force</option>
				<option value="chinese remainder theorem">chinese remainder theorem</option>
				<option value="combinatorics">combinatorics</option>
				<option value="constructive algorithms"Constructive algorithms">constructive algorithms</option>
				<option value="data structures">data structures</option>
				<option value="dfs and similar">dfs and similar</option>
				<option value="divide and conquer">divide and conquer</option>
				<option value="dp">dp</option>
				<option value="dsu">dsu</option>
				<option value="expression parsing">expression parsing</option>
				<option value="fft">fft</option>
				<option value="flows">flows</option>
				<option value="games">games</option>
				<option value="geometry">geometry</option>
				<option value="graph matchings">graph matchings</option>
				<option value="graphs">graphs</option>
				<option value="greedy">greedy</option>
				<option value="hashing">hashing</option>
				<option value="implementation">implementation</option>
				<option value="interactive">interactive</option>
				<option value="math">math</option>
				<option value="matrices">matrices</option>
				<option value="meet-in-the-middle">meet-in-the-middle</option>
				<option value="number theory">number theory</option>
				<option value="probabilities">probabilities</option>
				<option value="schedules">schedules</option>
				<option value="shortest paths">shortest paths</option>
				<option value="sortings">sortings</option>
				<option value="string suffix structures">string suffix structures</option>
				<option value="strings">strings</option>
				<option value="ternary search">ternary search</option>
				<option value="trees">trees</option>
				<option value="two pointers">two pointers</option>
			</select>
			<button id="included-tags-selector-button" onclick="addIncludedTag()" class="aText">add</button>
		</div>
		<br>
		<!-- exclude tags selector -->
		<div id="excludedtagsSelector" class="divArea">
			<!-- js for selector -->
			<script>
				function inputExcludedTag(newtag)
				{
					console.log(`exclude ${newtag}`);
					const inputElement=document.getElementById("excluded-tags");
					if(inputElement.value!="") inputElement.value+=",";
					inputElement.value+=newtag;
				}
				// add the tag selected currently to input box
				function addExcludedTag()
				{
					const selectorElement=document.getElementById("excluded-tags-selector");
					const newtag=selectorElement.value;
					inputExcludedTag(newtag);
				}
				// clear inputbox
				function clearExcludedTag()
				{
					const selectorElement=document.getElementById("excluded-tags-selector");
					const newtag=selectorElement.value;
					console.log("clear");
					const inputElement=document.getElementById("excluded-tags");
					inputElement.value="";
				}
			</script>
			<a class="aText">excluded tags:</a>
			<input type="text" id="excluded-tags" class="inputBox150" placeholder="empty">
			<button id="excluded-tags-clear-button" onclick="clearExcludedTag()" class="aText">clear</button>
			<select id="excluded-tags-selector" class="selectBox100" title="excluded tags selector">
				<option value="2-sat">2-sat</option>
				<option value="binary search">binary search</option>
				<option value="bitmasks">bitmasks</option>
				<option value="brute force">brute force</option>
				<option value="chinese remainder theorem">chinese remainder theorem</option>
				<option value="combinatorics">combinatorics</option>
				<option value="constructive algorithms"Constructive algorithms">constructive algorithms</option>
				<option value="data structures">data structures</option>
				<option value="dfs and similar">dfs and similar</option>
				<option value="divide and conquer">divide and conquer</option>
				<option value="dp">dp</option>
				<option value="dsu">dsu</option>
				<option value="expression parsing">expression parsing</option>
				<option value="fft">fft</option>
				<option value="flows">flows</option>
				<option value="games">games</option>
				<option value="geometry">geometry</option>
				<option value="graph matchings">graph matchings</option>
				<option value="graphs">graphs</option>
				<option value="greedy">greedy</option>
				<option value="hashing">hashing</option>
				<option value="implementation">implementation</option>
				<option value="interactive">interactive</option>
				<option value="math">math</option>
				<option value="matrices">matrices</option>
				<option value="meet-in-the-middle">meet-in-the-middle</option>
				<option value="number theory">number theory</option>
				<option value="probabilities">probabilities</option>
				<option value="schedules">schedules</option>
				<option value="shortest paths">shortest paths</option>
				<option value="sortings">sortings</option>
				<option value="string suffix structures">string suffix structures</option>
				<option value="strings">strings</option>
				<option value="ternary search">ternary search</option>
				<option value="trees">trees</option>
				<option value="two pointers">two pointers</option>
			</select>
			<button id="excluded-tags-selector-button" onclick="addExcludedTag()" class="aText">add</button>
		</div>
		<br>
		<!-- use luogu link checker -->
		<div class="divArea">
		<input type="checkbox" id="use-luogu-link" title="use link from luogu instead of cf, such as luogu.com.cn/problem/CF1A instead of codeforces.com/problemset/problem/1/A">
		<a class="aText"> use luogu link </a> <br>
		</div>
		<!-- run main() -->
		<button id="random-main" onclick="main()" class="buttonRandom">
			<b>random!</b>
		</button>
		<br><br>
		<div>
			<p class="pText">
			by <a href="https://github.com/wangyizhi571247" class="aFootLink">wangyizhi571247</a>
			,
			<a href="https://github.com/wangyizhi571247/CF-random" class="aFootLink">CF-random(github)</a>
			</p>
		</div>
	</div>
	<!-- for randomlist -->
	<div id="randomlist" class="divList">
		<p>
			<b>Problems</b>
			<button onclick="clearRandomlist()">clear</button>
			<button onclick="copyRandomlist()">copy</button>
			<input type="checkbox" id="use-prefix-CF" title="copy problem id with prefix CF, such as CF1A instead of 1A">
			<a class="aText"> copy with prefix CF </a>
			<br>
		</p>
		<div id="randomlistProblems" class="divArea">
		</div>
	</div>
</body>
</html>